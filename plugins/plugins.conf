# ============================================================================
# Tmux Plugin Manager Configuration
# ============================================================================
# This file lists all plugins to be installed via TPM
# Add plugins here, then run prefix+i to install them

# ============================================================================
# Note: Plugin Data Directories
# ============================================================================
# The directories used by tmux-resurrect (~/.tmux/resurrect) and other plugins
# are created automatically by install.sh, update.sh, and tmux-start.sh
# This ensures first-time startup works without missing directory errors

# ============================================================================
# Core & Session Experience
# ============================================================================

# Plugin manager (required)
set -g @plugin 'tmux-plugins/tpm'

# Sensible defaults
set -g @plugin 'tmux-plugins/tmux-sensible'

# Save and restore tmux sessions
set -g @plugin 'tmux-plugins/tmux-resurrect'

# Auto-save and restore sessions
set -g @plugin 'tmux-plugins/tmux-continuum'

# ============================================================================
# Discoverability & UX Guidance
# ============================================================================

# Keybinding hints (shows available keys after prefix)
# DISABLED: upstream repo no longer exists (404) - use built-in prefix-highlight instead
# set -g @plugin 'tmux-plugins/tmux-which-key'

# Prefix indicator (shows when prefix is active)
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'

# ============================================================================
# Sessions, Windows & Navigation
# ============================================================================

# Interactive session/window/pane switcher (fzf-based)
# Popular plugin (1.3k+ stars) - comprehensive tmux management via fzf
set -g @plugin 'sainnhe/tmux-fzf'

# ============================================================================
# Additional Useful Plugins
# ============================================================================

# Better copy/paste
set -g @plugin 'tmux-plugins/tmux-yank'

# Open files/URLs
set -g @plugin 'tmux-plugins/tmux-open'

# Better pane navigation
set -g @plugin 'tmux-plugins/tmux-pain-control'

# Battery status with horizontal bar visualization (red left, green right)
set -g @plugin 'tmux-plugins/tmux-battery'

# ============================================================================
# Plugin Configuration
# ============================================================================

# tmux-resurrect: Save and restore tmux sessions
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-save-bash-history 'on'

# Explicitly list processes to capture (helps with detection)
# Use ~ to match processes containing the name (useful for node-based apps like cursor-agent)
# Note: Some programs (like htop) restore perfectly, while others (like lazygit/cursor-agent)
# may only show the saved screen buffer without restarting. This is a known limitation
# of tmux-resurrect - the pane strategy relies on process detection which doesn't always work
# for all interactive TUI programs.
set -g @resurrect-processes 'lazygit lg "~cursor-agent" docker-compose "docker compose"'

# Restore strategies for specific programs
# 'pane' strategy: re-runs the command that was in the pane
# 'session' strategy: tries to restore the entire session state (for vim/nvim)
set -g @resurrect-strategy-lazygit 'pane'
set -g @resurrect-strategy-lg 'pane'
set -g @resurrect-strategy-htop 'pane'
set -g @resurrect-strategy-top 'pane'
set -g @resurrect-strategy-btop 'pane'
set -g @resurrect-strategy-docker-compose 'pane'
set -g @resurrect-strategy-docker 'pane'
# Note: cursor-agent runs as 'node' with cursor-agent in the path
# The ~cursor-agent pattern should match it, but we need to ensure it restores correctly
set -g @resurrect-strategy-nvim 'session'
set -g @resurrect-strategy-vim 'session'

# tmux-continuum: Auto-save and restore
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'

# tmux-yank: Better copy/paste
set -g @yank_selection 'clipboard'
set -g @yank_selection_mouse 'clipboard'

# tmux-open: Open files/URLs
set -g @open 'C-o'

# Note: tmux-copycat (enhanced search) is NOT installed because it conflicts
# with our lock mode keybinding (Ctrl+g). Use tmux's native search instead (Ctrl+s for scroll mode)

# tmux-which-key: Keybinding hints
# Shows available keys after pressing prefix
# Works automatically with our modal keybindings

# tmux-prefix-highlight: Prefix indicator
# Shows in status bar when prefix is active
set -g @prefix_highlight_show_copy_mode 'on'
set -g @prefix_highlight_copy_mode_attr 'fg=colour231,bg=colour238'

# tmux-fzf: Interactive switcher (sainnhe/tmux-fzf)
# Comprehensive fzf-based tmux management tool
# Default keybinding: prefix + F (Shift+F)
# Features: sessions, windows, panes, commands, keybindings, clipboard, processes
# Supports popup windows (tmux 3.2+) for fullscreen experience
# Custom keybinding configured via TMUX_FZF_LAUNCH_KEY environment variable
# We configure it to use Ctrl+o -> w for session switching via session-switcher.sh
# See: https://github.com/sainnhe/tmux-fzf

# tmux-battery: Battery status with horizontal bar visualization
# Provides #{battery_graph} - horizontal bar with red (left/low) to green (right/high)
# Provides #{battery_percentage} - battery percentage
# Provides #{battery_icon} - battery status icon
# The graph uses tiered icons (█, ▇, ▆, ▅, ▄, ▃, ▂, ▁) based on charge level
# Colors automatically change from green (high) to red (low)
# See: https://github.com/tmux-plugins/tmux-battery
